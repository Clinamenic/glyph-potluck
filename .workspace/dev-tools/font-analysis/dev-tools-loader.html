<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Font Dev Tools Loader</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: #2c3e50;
        color: white;
        border-radius: 8px;
      }
      .section {
        margin: 20px 0;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #fafafa;
      }
      .command {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        margin: 10px 0;
      }
      .note {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        padding: 15px;
        border-radius: 5px;
        margin: 15px 0;
      }
      .warning {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        padding: 15px;
        border-radius: 5px;
        margin: 15px 0;
      }
      .success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        padding: 15px;
        border-radius: 5px;
        margin: 15px 0;
      }
      button {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #2980b9;
      }
      .status {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
      }
      .status.loading {
        background: #e3f2fd;
      }
      .status.success {
        background: #e8f5e8;
      }
      .status.error {
        background: #ffebee;
      }

      /* Drop Zone Styles */
      .drop-zone-container {
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 2px dashed #dee2e6;
      }

      .drop-zone {
        border: 3px dashed #007bff;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 20px 0;
      }

      .drop-zone:hover {
        border-color: #0056b3;
        background: #f8f9ff;
      }

      .drop-zone.drag-over {
        border-color: #28a745;
        background: #f8fff9;
        transform: scale(1.02);
      }

      .drop-zone-content {
        pointer-events: none;
      }

      .drop-icon {
        font-size: 48px;
        margin-bottom: 15px;
      }

      .drop-hint {
        color: #6c757d;
        font-size: 14px;
        margin-top: 5px;
      }

      .file-info {
        background: #e8f5e8;
        border: 1px solid #28a745;
        border-radius: 5px;
        padding: 15px;
        margin-top: 15px;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn-primary {
        background: #007bff;
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: #0056b3;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover:not(:disabled) {
        background: #1e7e34;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover:not(:disabled) {
        background: #545b62;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîß Font Dev Tools</h1>
        <p>Development and Quality Control Tools for Glyph Potluck</p>
      </div>

      <div class="section">
        <h2>üöÄ Quick Start</h2>
        <p>
          These tools help you analyze generated fonts and track consistency
          from uploaded images through vectorization to final font files.
        </p>

        <div class="note">
          <strong>Note:</strong> This is a development tool. Load it in your
          browser while using the main Glyph Potluck application.
        </div>
      </div>

      <div class="section">
        <h2>üìã Available Commands</h2>
        <p>
          Once loaded, these commands will be available in your browser console:
        </p>

        <div class="command">window.FontDevTools.analyzeCurrentFont()</div>
        <p>
          Analyzes the currently generated font and compares it with original
          vectorized glyphs.
        </p>

        <div class="command">window.FontDevTools.quickQualityCheck()</div>
        <p>Quick quality assessment of the current font.</p>

        <div class="command">window.FontDevTools.analyzeCharacter(65)</div>
        <p>Analyzes a specific character (65 = 'A').</p>

        <div class="command">window.FontDevTools.help()</div>
        <p>Shows help and available commands.</p>
      </div>

      <div class="section">
        <h2>üîç What These Tools Analyze</h2>
        <ul>
          <li>
            <strong>Coordinate System:</strong> Detects if Y-axis is correctly
            flipped
          </li>
          <li>
            <strong>Character Orientation:</strong> Identifies upside-down
            characters
          </li>
          <li><strong>Path Quality:</strong> Checks glyph path integrity</li>
          <li>
            <strong>Transformation Accuracy:</strong> Compares original SVG with
            generated OpenType
          </li>
          <li>
            <strong>Font Metrics:</strong> Validates ascender, descender, etc.
          </li>
        </ul>
      </div>

      <div class="section">
        <h2>üß™ Testing the Tools</h2>
        <p>Click the button below to test if the dev tools are working:</p>

        <button onclick="testDevTools()">Test Dev Tools</button>
        <button onclick="loadDevTools()">Load Dev Tools</button>

        <div id="status" class="status"></div>

        <!-- Font File Drop Zone -->
        <div class="drop-zone-container">
          <h3>üìÅ Font File Analysis</h3>
          <div id="fontDropZone" class="drop-zone">
            <div class="drop-zone-content">
              <div class="drop-icon">üìÅ</div>
              <p>Drop your generated font file here (.ttf, .otf)</p>
              <p class="drop-hint">or click to browse</p>
            </div>
            <input
              type="file"
              id="fontFileInput"
              accept=".ttf,.otf"
              style="display: none"
            />
          </div>
          <div id="fontFileInfo" class="file-info" style="display: none">
            <p><strong>Selected File:</strong> <span id="fileName"></span></p>
            <p><strong>Size:</strong> <span id="fileSize"></span></p>
          </div>
        </div>

        <div class="button-group">
          <button id="loadButton" class="btn btn-primary">
            Load Dev Tools
          </button>
          <button id="analyzeButton" class="btn btn-success" disabled>
            Analyze Font
          </button>
          <button id="testButton" class="btn btn-secondary" disabled>
            Test Dev Tools
          </button>
        </div>
      </div>

      <div class="section">
        <h2>üìñ Usage Workflow</h2>
        <ol>
          <li>
            <strong>Load this page</strong> in your browser (while using Glyph
            Potluck)
          </li>
          <li><strong>Generate a font</strong> in the main application</li>
          <li><strong>Open browser console</strong> (F12 ‚Üí Console)</li>
          <li>
            <strong>Run analysis:</strong>
            <code>window.FontDevTools.analyzeCurrentFont()</code>
          </li>
          <li><strong>Review results</strong> and fix any issues identified</li>
        </ol>
      </div>

      <div class="section">
        <h2>‚ö†Ô∏è Important Notes</h2>
        <div class="warning">
          <strong>Development Only:</strong> These tools are for development and
          debugging only. They should not be included in production builds.
        </div>

        <div class="note">
          <strong>Browser Console Required:</strong> These tools work through
          the browser console. Make sure you have developer tools open.
        </div>

        <div class="success">
          <strong>No Code Changes:</strong> You don't need to modify your main
          application code. These tools work independently.
        </div>
      </div>
    </div>

    <script>
      let devToolsLoaded = false;
      let devToolsStatus = "";

      function updateStatus(message, type = "loading") {
        const statusEl = document.getElementById("status");
        statusEl.textContent = message;
        statusEl.className = `status ${type}`;
      }

      async function loadDevTools() {
        try {
          updateStatus("Loading dev tools...", "loading");

          // Check if already loaded
          if (window.FontDevTools) {
            console.log("üîß Font Dev Tools already loaded");
            statusDiv.innerHTML =
              '<span style="color: green;">‚úÖ Dev Tools already loaded!</span>';
            loadButton.textContent = "Already Loaded";
            return;
          }

          // Check if script is already in DOM
          if (document.getElementById("font-dev-tools-script")) {
            console.log("üîß Dev tools script already in DOM");
            statusDiv.innerHTML =
              '<span style="color: orange;">‚ö†Ô∏è Script already loaded, refreshing...</span>';
            // Remove old script and reload
            document.getElementById("font-dev-tools-script").remove();
          }

          // Load the dev tools script
          const script = document.createElement("script");
          script.src = "./dev-console-bridge.js";
          script.id = "font-dev-tools-script";

          script.onload = () => {
            updateStatus(
              "Dev tools loaded successfully! Check console for confirmation.",
              "success"
            );
            devToolsLoaded = true;
          };

          script.onerror = () => {
            updateStatus(
              "Failed to load dev tools. Check console for errors.",
              "error"
            );
          };

          document.head.appendChild(script);
        } catch (error) {
          updateStatus(`Error loading dev tools: ${error.message}`, "error");
        }
      }

      async function testDevTools() {
        if (!devToolsLoaded) {
          updateStatus("Please load dev tools first!", "error");
          return;
        }

        try {
          updateStatus("Testing dev tools...", "loading");

          // Check if FontDevTools is available
          if (window.FontDevTools) {
            updateStatus(
              "Dev tools are working! Check console for help.",
              "success"
            );
            console.log("‚úÖ Dev tools loaded successfully");

            // Show help
            if (window.FontDevTools.help) {
              window.FontDevTools.help();
            }
          } else {
            updateStatus(
              "Dev tools not found. Try loading them again.",
              "error"
            );
          }
        } catch (error) {
          updateStatus(`Test failed: ${error.message}`, "error");
        }
      }

      // Auto-load dev tools when page loads
      window.addEventListener("load", () => {
        setTimeout(loadDevTools, 1000);
        setupDropZone();
      });

      // Setup drag and drop functionality
      function setupDropZone() {
        const dropZone = document.getElementById("fontDropZone");
        const fileInput = document.getElementById("fontFileInput");
        const analyzeButton = document.getElementById("analyzeButton");
        let currentFontFile = null;

        // Click to browse
        dropZone.addEventListener("click", () => {
          fileInput.click();
        });

        // File input change
        fileInput.addEventListener("change", (e) => {
          const file = e.target.files[0];
          if (
            file &&
            (file.name.endsWith(".ttf") || file.name.endsWith(".otf"))
          ) {
            handleFontFile(file);
          }
        });

        // Drag and drop events
        dropZone.addEventListener("dragover", (e) => {
          e.preventDefault();
          dropZone.classList.add("drag-over");
        });

        dropZone.addEventListener("dragleave", (e) => {
          e.preventDefault();
          dropZone.classList.remove("drag-over");
        });

        dropZone.addEventListener("drop", (e) => {
          e.preventDefault();
          dropZone.classList.remove("drag-over");

          const files = e.dataTransfer.files;
          if (files.length > 0) {
            const file = files[0];
            if (file.name.endsWith(".ttf") || file.name.endsWith(".otf")) {
              handleFontFile(file);
            } else {
              alert("Please drop a .ttf or .otf font file");
            }
          }
        });

        // Handle selected font file
        function handleFontFile(file) {
          currentFontFile = file;

          // Update UI
          document.getElementById("fileName").textContent = file.name;
          document.getElementById("fileSize").textContent = formatFileSize(
            file.size
          );
          document.getElementById("fontFileInfo").style.display = "block";

          // Enable analyze button
          analyzeButton.disabled = false;

          // Store file globally for dev tools
          window.__CURRENT_FONT_FILE__ = file;

          console.log(
            "‚úÖ Font file loaded:",
            file.name,
            formatFileSize(file.size)
          );
        }

        // Analyze button click
        analyzeButton.addEventListener("click", async () => {
          if (!currentFontFile) {
            alert("Please select a font file first");
            return;
          }

          if (!window.FontDevTools) {
            alert("Please load dev tools first");
            return;
          }

          try {
            analyzeButton.disabled = true;
            analyzeButton.textContent = "Analyzing...";

            // Use the dev tools to analyze the file
            const result = await window.FontDevTools.analyzeFontFile(
              currentFontFile
            );

            console.log("üìä Analysis complete:", result);
            updateStatus(
              "Font analysis complete! Check console for results.",
              "success"
            );
          } catch (error) {
            console.error("‚ùå Analysis failed:", error);
            updateStatus(`Analysis failed: ${error.message}`, "error");
          } finally {
            analyzeButton.disabled = false;
            analyzeButton.textContent = "Analyze Font";
          }
        });

        // Format file size
        function formatFileSize(bytes) {
          if (bytes === 0) return "0 Bytes";
          const k = 1024;
          const sizes = ["Bytes", "KB", "MB", "GB"];
          const i = Math.floor(Math.log(bytes) / Math.log(k));
          return (
            parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i]
          );
        }
      }
    </script>
  </body>
</html>
